<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <title>ORYX Robot — Interactive</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <style>
    html,body { height:100%; margin:0; background:#243b4a }
    canvas { display:block }
    .hud {
      position:fixed; inset:auto 12px 12px 12px; padding:10px 12px;
      font:14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial;
      background:rgba(0,0,0,.35); color:#fff; border:1px solid rgba(255,255,255,.15); border-radius:10px
    }
    .hud b { color:#f99f00 }
  </style>
</head>
<body>
  <div class="hud" id="hud">جاري التهيئة…</div>

  <script type="module">
    // ====== إعدادات الهوية ======
    const ORYX_BLUE   = 0x243b4a;
    const ORYX_ORANGE = 0xf99f00;

    // مهم: بما أن GLB في نفس الجذر، نستخدم مسار نسبي (لا تبدأ بـ /)
    const ROBOT_URL = "./Eclipse_Sentinel_0813205056_texture.glb";

    // ====== أدوات ======
    const hud = document.getElementById('hud');
    const log = (msg) => hud.innerHTML = msg;
    const apx = (n) => (n ?? 0).toFixed(0);

    // فحص مسبق للرابط (يساعد لو في 404 أو مسار غلط)
    try {
      const headResp = await fetch(ROBOT_URL, { method: 'HEAD', cache: 'no-store' });
      if (!headResp.ok) {
        log(`❌ لم أستطع الوصول للملف:<br><b>${ROBOT_URL}</b><br>HTTP ${headResp.status}. 
        تأكد من الاسم والمسار والحروف الكبيرة/الصغيرة. إن كان الملف داخل مجلد، عدّل ROBOT_URL ليتوافق معه.`);
      } else {
        log(`✅ الرابط سليم: <b>${ROBOT_URL}</b><br>ابدأ التحميل…`);
      }
    } catch (e) {
      log(`❌ فشل فحص الرابط (HEAD): ${e?.message || e}`);
    }

    // ====== تحميل Three من CDN (المكتبات فقط) ======
    const [{ default: * as THREE }, { GLTFLoader }] = await Promise.all([
      import("https://unpkg.com/three@0.160.0/build/three.module.js"),
      import("https://unpkg.com/three@0.160.0/examples/jsm/loaders/GLTFLoader.js"),
    ]);

    // ====== مشهد أساسي ======
    const renderer = new THREE.WebGLRenderer({ antialias:true });
    renderer.setSize(innerWidth, innerHeight);
    renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    renderer.outputColorSpace = THREE.SRGBColorSpace;
    document.body.appendChild(renderer.domElement);

    const scene = new THREE.Scene();
    scene.background = new THREE.Color(ORYX_BLUE);

    const camera = new THREE.PerspectiveCamera(50, innerWidth/innerHeight, .1, 100);
    camera.position.set(0, 1.6, 3);

    scene.add(new THREE.HemisphereLight(0xffffff, ORYX_BLUE, .6));
    const rim = new THREE.DirectionalLight(ORYX_ORANGE, 1.1); rim.position.set(1.5,1.2,1); scene.add(rim);
    const key = new THREE.DirectionalLight(0xffffff, .8);    key.position.set(-1.2,1.5,2); scene.add(key);

    // ====== تحميل GLB ======
    let robot, headBone = null, t = 0, mx = .5, my = .5;

    const loader = new GLTFLoader();
    loader.load(
      ROBOT_URL,
      (gltf) => {
        robot = gltf.scene;
        robot.traverse((o)=>{
          if (o.isMesh) { o.castShadow = o.receiveShadow = true; if (o.material && 'roughness' in o.material) o.material.roughness = .35; }
          if (!headBone && /head|neck/i.test(o.name)) headBone = o;
        });

        // Center & scale
        const box = new THREE.Box3().setFromObject(robot);
        const size = new THREE.Vector3(); box.getSize(size);
        const center = new THREE.Vector3(); box.getCenter(center);
        robot.position.sub(center);
        robot.scale.setScalar(1.7 / (size.y || 1));
        scene.add(robot);

        log(`✅ تم التحميل — الحجم التقريبي: <b>${apx(size.x)}×${apx(size.y)}×${apx(size.z)}</b>`);
      },
      (e) => log(`⏳ تحميل: <b>${apx((e.loaded/e.total)*100 || 0)}%</b>`),
      (err) => {
        console.error(err);
        log(`❌ فشل تحميل GLB:<br><b>${ROBOT_URL}</b><br>${err?.message || err}`);
      }
    );

    // تفاعل الماوس
    addEventListener('mousemove', (e)=>{ mx = e.clientX/innerWidth; my = e.clientY/innerHeight; });

    // حلقة الرسم
    renderer.setAnimationLoop(()=>{
      t += 0.016;
      if (robot){
        const tiltX = (my - 0.5) * -0.15;
        const tiltY = (mx - 0.5) *  0.25;
        robot.rotation.x = THREE.MathUtils.lerp(robot.rotation.x, tiltX, 0.08);
        robot.rotation.y = THREE.MathUtils.lerp(robot.rotation.y, tiltY, 0.08);
        robot.position.y = Math.sin(t*1.2) * 0.02;

        if (headBone){
          headBone.rotation.y = THREE.MathUtils.lerp(headBone.rotation.y, (mx-0.5)*0.6, 0.15);
          headBone.rotation.x = THREE.MathUtils.lerp(headBone.rotation.x, (my-0.5)*-0.4, 0.15);
        }
      }
      renderer.render(scene, camera);
    });

    // Resize
    addEventListener('resize', ()=>{
      camera.aspect = innerWidth/innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(innerWidth, innerHeight);
      renderer.setPixelRatio(Math.min(devicePixelRatio, 2));
    });

    // اختبارات بسيطة (تظهر بالكونسول)
    console.assert(!!document.querySelector('canvas'), '[TEST] canvas mounted');
    console.assert(ROBOT_URL.startsWith('./'), '[TEST] ROBOT_URL is relative (Pages-safe)');
  </script>
</body>
</html>
